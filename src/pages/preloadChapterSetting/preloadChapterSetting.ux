<template>
    <div class="page" style="flex-direction: column;">
      <div class="item">
        <text static style="font-size: 24px;font-weight:bold;color: rgba(255, 255, 255, 0.6);text-align: center;margin-bottom:80px">开启后将一次性加载整章内容到内存，可提升阅读流畅度，但会增加章节加载时间。</text>
        <img static src="/common/images/Switch_ON.png" style="width: 113px;height: 80px;" @click="onClick" if="{{enable}}"/>
        <img static src="/common/images/Switch_OFF.png" style="width: 113px;height: 80px;" @click="onClick" else/>
        <text style="font-size: 36px;font-weight:bold;color: white;width: 100%;text-align: center;">
          {{enable ? 'ON' : 'OFF'}}
        </text>
      </div>
      <img static src="/common/images/back.png" @click="back" style="position: absolute;left: 6px;top: 6px;width: 72px;height: 72px;"/>
      <text style="position: absolute;left: 78px;top: 7px;width: 180px;line-height: 32px;font-weight:bold;font-size:24px;color:rgba(255,255,255,0.6);text-align:center;">
        {{nowTime}}
      </text>
      <text static style="position: absolute;left: 78px;top: 35px;width: 180px;line-height: 42px;font-weight:bold;font-size:32px;color:white;text-align:center;">
        预载章节
      </text>
    </div>
  </template>
  
  <script>
  import router from '@system.router'
  import storage from '../../common/storage.js'
  
  export default {
    private: {
      enable: false,
      nowTime: "00:00",
      timer: null
    },
    updateTime() {
      const date = new Date();
      let hours = date.getHours();
      let minutes = date.getMinutes();
      hours = hours < 10 ? '0' + hours : hours;
      minutes = minutes < 10 ? '0' + minutes : minutes;
      this.nowTime = `${hours}:${minutes}`;
    },
    onInit() {
      this.updateTime();
      this.timer = setInterval(() => {
        this.updateTime();
      }, 1000);
      storage.get({
        key: 'EBOOK_PRELOAD_CHAPTER',
        success: (data) => {
          this.enable = data === 'true';
        },
        default: 'false'
      })
    },
    onDestroy(){
      if (this.timer) {
        clearInterval(this.timer);
        this.timer = null;
      }
    },
    back(){
      router.back();
    },
    save(){
      storage.set({
        key: 'EBOOK_PRELOAD_CHAPTER',
        value: this.enable.toString()
      })
    },
    onClick(){
      this.enable = !this.enable;
      this.save()
    }
  }
  </script>
  
  <style>
  .page {
    width: 336px;
    height: 480px;
    background-color: #000000;
  }
  .item {
    position: absolute;
    left: 6px;
    top: 86px;
    width: 324px;
    height: 308px;
    border-radius: 36px;
    flex-direction: column;
    border: 3px solid #262626;
    align-items: center;
    justify-content: space-between;
    padding: 20px;
  }
  </style>