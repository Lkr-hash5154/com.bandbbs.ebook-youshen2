<template>
  <div class="page" style="flex-direction: column;">
    <div class="item">
      <text static style="font-size: 24px;font-weight:bold;color: rgba(255, 255, 255, 0.6);text-align: center;margin-bottom:80px">关闭后将不再检查封面图片是否存在，可以加快书架加载速度。</text>
      <img static src="/common/images/Switch_ON.png" style="width: 102px;height: 72px;" @click="onClick" if="{{enable}}"/>
      <img static src="/common/images/Switch_OFF.png" style="width: 102px;height: 72px;" @click="onClick" else/>
      <text style="font-size: 36px;font-weight:bold;color: white;width: 100%;text-align: center;">
        {{enable ? 'ON' : 'OFF'}}
      </text>
    </div>
    <img static src="/common/images/back.png" @click="back" style="position: absolute;left: 38px;top: 24px;width: 82px;height: 82px;"/>
    <text style="position: absolute;left: 44px;top: 16px;width: 172px;line-height: 32px;font-weight:bold;font-size:24px;color:rgba(255,255,255,0.6);text-align:center;">
      {{nowTime}}
    </text>
    <text static style="position: absolute;left: 24px;top: 46px;width: 172px;line-height: 42px;font-weight:bold;font-size:32px;color:white;text-align:center;">
      检查封面
    </text>
  </div>
</template>

<script>
import router from '@system.router'
import storage from '../../utils/storage.js'

export default {
  private: {
    enable: false,
    nowTime: "00:00",
    timer: null
  },
  updateTime() {
    const date = new Date();
    let hours = date.getHours();
    let minutes = date.getMinutes();
    hours = hours < 10 ? '0' + hours : hours;
    minutes = minutes < 10 ? '0' + minutes : minutes;
    this.nowTime = `${hours}:${minutes}`;
  },
  onInit() {
    this.updateTime();
    this.timer = setInterval(() => {
      this.updateTime();
    }, 1000);
    storage.get({
      key: 'EBOOK_CHECK_COVER',
      success: (data) => {
        this.enable = data === 'true';
      },
      default: 'false'
    })
  },
  onDestroy(){
    if (this.timer) {
      clearInterval(this.timer);
      this.timer = null;
    }
  },
  back(){
    router.back();
  },
  save(){
    storage.set({
      key: 'EBOOK_CHECK_COVER',
      value: this.enable.toString()
    })
  },
  onClick(){
    this.enable = !this.enable;
    this.save()
  }
}
</script>

<style>
.page {
  width: 192px;
  height: 490px;
  background-color: #000000;
}
.item {
  position: absolute;
  left: 20px;
  top: 126px;
  width: 192px;
  height: 328px;
  border-radius: 36px;
  flex-direction: column;
  border: 3px solid #262626;
  align-items: center;
  justify-content: space-between;
  padding: 20px;
}
</style>
