<import name="number" src="../../components/number_choose/number_choose"></import>
<template>
  <div class="page" style="flex-direction: column;">

	<div class="item">
		<text static style="font-size: 22px;font-weight:bold;color: rgba(255, 255, 255, 0.6);text-align: center;margin-bottom:80px">长按文本以启动自动翻页</text>

		<img static src="/common/images/Switch_ON.png" style="width: 84px;height: 60px;" @click="onClick" if="{{enable}}"/>
		<img static src="/common/images/Switch_OFF.png" style="width: 84px;height: 60px;" @click="onClick" else/>
		<text style="font-size: 18px;font-weight:bold;color: white;width: 100%;text-align: center;">
			{{enable ? 'ON' : 'OFF'}}
		</text>
	</div>

	<number style="position: absolute; top: 365px" max.static="60" min.static="1" step.static="1" unit.static="s" value="{{speed}}" @change="change" name.static="间隔时间"></number>

	<text style="position: absolute;top: 16px;width: 192px;line-height: 32px;font-weight:bold;font-size:18px;color:rgba(255,255,255,0.6);text-align:center;">
	  {{nowTime}}
	</text>
	<text static style="position: absolute;top: 36px;width: 192px;line-height: 42px;font-weight:bold;font-size:26px;color:white;text-align:center;">
		自动翻页
	</text>
  </div>
</template>

<script>
import router from '@system.router'
import storage from '../../utils/storage.js'

export default {
  private: {
		speed: 10,
		enable: false,
		nowTime: "00:00",
		timer: null
  },
  updateTime() {
		const date = new Date();
		let hours = date.getHours();
		let minutes = date.getMinutes();

		hours = hours < 10 ? '0' + hours : hours;
		minutes = minutes < 10 ? '0' + minutes : minutes;

		this.nowTime = `${hours}:${minutes}`;
	},
  onInit() {
	this.updateTime();
	this.timer = setInterval(() => {
		this.updateTime();
	}, 1000);
    storage.get({
      key: 'EBOOK_AUTO',
      success: (data) => {
        if (data) {
			({speed:this.speed,enable:this.enable}=JSON.parse(data))
        }
      }
    })
  },
  onDestroy(){
	  if (this.timer) {
		  clearInterval(this.timer);
		  this.timer = null;
	  }
	},
  change(e){
	  this.speed = e.detail.value;
	  this.save()
  },
  back(){
	  router.back();
	this.save()
  },save(){
	  storage.set({
		  key: 'EBOOK_AUTO',
		  value: JSON.stringify({speed:this.speed,enable:this.enable})
	  })
	},
  onClick(){
	  this.enable = !this.enable;
	  this.save()
  }
}
</script>

<style>
.page {
	width: 192px;
	height: 490px;
	background-color: #000000;
}

.item {
	position: absolute;
	left: 10px;
	top: 82px;
	width: 172px;
	border-radius: 26px;
	flex-direction: column;
	border: 3px solid #262626;
	align-items: center;
	justify-content: center;
	padding: 12px;
}
</style>
